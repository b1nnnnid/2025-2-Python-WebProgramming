{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ post.title }}</title>
    <link rel="stylesheet" href="{% static 'css/DetailPage.css'%}" />
</head>
<body>
    
    <!-- 전체 내용을 감싸는 중앙 컨테이너 -->
    <div class="post-container">
        
        <!-- 1. 상단 정보 (홈, 닉네임, 로그아웃) -->
        <div class="post-header-info">
            <a href="{% url 'posts:main' %}">홈으로</a>
            <div class="user-meta-group">
                <p>{{request.user.nickname}} 님</p>
                <a href="{% url 'accounts:logout' %}">로그아웃</a>
            </div>
        </div>

        <!-- 2. 게시글 메인 내용 -->
        <div class="post-main-content">
            <h2>{{ post.title }}</h2>
            
            <div class="post-content-body">
                <p>{{ post.content }}</p>
            </div>
            
            <div class="post-content-meta">
                <!-- 날짜와 작성자 정보를 메타 그룹에 포함 -->
                <p>{{ post.created_at }} | {% if post.is_anonymous %}익명{% else %}{{ post.author.nickname }}{% endif %}</p>
            </div>

            <!-- 3. 이미지/동영상 미디어 -->
            <div class="post-media-content">
                {% if post.image %}
                    <img src="{{ post.image.url }}" alt="첨부 이미지">
                {% endif %}
                {% if post.video %}
                    <video controls>
                        <source src="{{ post.video.url }}" type="video/mp4">
                    </video>
                {% endif %}
            </div>

            <!-- 4. 통계 및 액션 버튼 -->
            <div class="post-stats-bar">
                <p>댓글 {{ post.comments.count }} | 좋아요 {{ post.like.count }} | 스크랩 {{ post.scrap.count }}</p>
            </div>
            
            <div class="post-actions-group">
                <!-- 수정/삭제 버튼 -->
                {% if request.user == post.author %}
                <a href="{% url 'posts:update' post.id %}">수정하기</a>
                <a href="{% url 'posts:delete' post.id %}">삭제하기</a>
                {% endif %}

                <!-- 좋아요/스크랩 버튼 -->
                <a href="{% url 'posts:like' post.id %}">
                    <button type="button">{% if request.user in post.like.all %}좋아요 취소{% else %}좋아요{% endif %}</button>
                </a>
                <a href="{% url 'posts:scrap' post.id %}">
                    <button type="button">{% if request.user in post.scrap.all %}스크랩 취소{% else %}스크랩{% endif %}</button>
                </a>
            </div>
        </div>
        <!-- 2. 게시글 메인 내용 끝 -->
        
        <hr>

        <!-- 5. 댓글 섹션 -->
        <div class="comment-section">
            <h2>댓글</h2>
            <ul>
                {% for comment in post.comments.all %}
                <li>
                    <p>
                        {% if comment.is_anonymous %}
                            익명
                        {% else %}
                            {{ comment.author }}
                        {% endif %}
                        : {{ comment.content }} 
                        <small>{{ comment.created_at }}</small>
                    </p>
                </li>
                <hr>
            {% empty %}
                <p>댓글이 없습니다.</p>
            {% endfor %}
            </ul>

            <!-- 댓글 작성 폼 -->
            <form method="post" action="{% url 'posts:create-comment' post.id %}">
                {% csrf_token %}
                <textarea name="content" placeholder="댓글을 입력해 주세요."></textarea>
                <div>
                    <input type="checkbox" id="is_anonymous_comment" name="is_anonymous">
                    <label for="is_anonymous_comment">익명</label>
                    <button type="submit">댓글 작성</button>
                </div>
            </form>
        </div>
        <!-- 5. 댓글 섹션 끝 -->

    </div> 
    <!-- 전체 컨테이너 끝 -->

</body>
</html>